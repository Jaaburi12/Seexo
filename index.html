<!--
Laam P2P — BSC USDT Live (Single-file HTML)
Drop-in replacement/upgrade for the demo. Features:
- Connect MetaMask (or any injected EIP-1193 wallet)
- Detect BSC chain (Testnet 97 or Mainnet 56)
- Show ETH/BNB balance and BEP20 (USDT) token balance (includes decimals)
- Approve & Transfer USDT (uses ERC20 transfer)
- Friendly UI and safety checks

IMPORTANT:
- By default this file points to BSC Testnet (chainId 97). Change NETWORK = 'bsc' to 'bsc-testnet' or update CONTRACT_ADDRESS to mainnet USDT if you intend to use mainnet.
- Always test on testnet with small amounts first.

How to use:
1. Save as index.html and open in browser with MetaMask installed.
2. Switch MetaMask to BSC Testnet (or Mainnet if you changed settings).
3. Use the UI to connect, check balances, approve, and transfer USDT.

NOTE about USDT on BSC:
- USDT contracts differ between networks. Replace CONTRACT_ADDRESS with the correct token contract for your target network.

--><!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Laam P2P — BSC USDT Live</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#071022;--card:#081225;--muted:#9aa4b2;--accent:#7c3aed;--glass:rgba(255,255,255,0.03);--radius:12px}
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#041024,#071022);color:#e6eef8;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
  .wrap{width:100%;max-width:980px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:18px;border-radius:var(--radius);box-shadow:0 10px 30px rgba(2,6,23,0.6)}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  .logo{display:flex;gap:12px;align-items:center}
  .logo .box{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#3b82f6);display:flex;align-items:center;justify-content:center;font-weight:700}
  h1{margin:0;font-size:18px}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .controls{display:flex;gap:8px;align-items:center}
  button{cursor:pointer;border:0;padding:8px 12px;border-radius:10px}
  .btn-primary{background:var(--accent);color:#fff;font-weight:600}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:14px}
  .panel{background:var(--card);padding:12px;border-radius:10px}
  .row{display:flex;flex-direction:column;gap:8px}
  input,select{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:inherit}
  .small{font-size:13px;color:var(--muted)}
  .stat{display:flex;gap:12px;align-items:center}
  .token-balance{font-size:18px;font-weight:700}
  .danger{color:#ff6b6b}
  .success{color:#4ade80}
  .log{max-height:220px;overflow:auto;font-size:13px;color:var(--muted)}
  @media (max-width:900px){.grid{grid-template-columns:1fr}} 
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo">
          <div class="box">LAAM</div>
          <div>
            <h1>Laam P2P — BSC USDT Live</h1>
            <p class="lead">Connect MetaMask, view USDT (BEP20) balance, Approve & Transfer.</p>
          </div>
        </div>
        <div class="controls">
          <div id="userInfo" class="small">Not connected</div>
          <button id="btnConnect" class="btn-primary">Connect Wallet</button>
        </div>
      </header><main class="grid">
    <section>
      <div class="panel">
        <div class="row">
          <div class="stat"><div>
            <div class="small">Network</div>
            <div id="networkName">—</div>
          </div>
          <div style="margin-left:auto;text-align:right">
            <div class="small">BNB Balance</div>
            <div id="bnbBal">—</div>
          </div></div>

          <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03)">

          <div>
            <div class="small">USDT (BEP20) Contract</div>
            <div id="tokenAddr" class="small">—</div>
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
            <div>
              <div class="small">Token</div>
              <div><span id="tokenSymbol">—</span> <span class="small">•</span> <span id="tokenDecimals" class="small">— decimals</span></div>
            </div>
            <div style="text-align:right">
              <div class="small">Balance</div>
              <div class="token-balance" id="tokenBalance">—</div>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="btnRefresh" class="btn-ghost">Refresh Balances</button>
            <button id="btnSwitchNet" class="btn-ghost">Switch Network</button>
          </div>

          <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03)">

          <div class="small">Transfer USDT</div>
          <input id="toAddr" placeholder="Recipient address" />
          <input id="sendAmount" placeholder="Amount (decimal)" />
          <div style="display:flex;gap:8px">
            <button id="btnApprove" class="btn-ghost">Approve Spender</button>
            <button id="btnTransfer" class="btn-primary">Transfer (transfer)</button>
          </div>

          <div style="margin-top:10px" class="small">Approval spender (optional):
            <input id="spenderAddr" placeholder="Spender address (for approval)" style="width:100%;margin-top:6px" />
          </div>

          <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03)">

          <div class="small">Logs</div>
          <div id="log" class="log"></div>
        </div>
      </div>
    </section>

    <aside>
      <div class="panel">
        <div class="small">Important notes</div>
        <ul class="small">
          <li>This UI uses Ethers.js (CDN). MetaMask must be installed.</li>
          <li>By default the file targets <strong>BSC Testnet</strong>. Change CONTRACT_ADDRESS for mainnet tokens.</li>
          <li>Always test small amounts first. This demo sends real blockchain transactions when on mainnet.</li>
        </ul>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03)">

        <div class="small">Quick troubleshooting</div>
        <ol class="small">
          <li>Wallet not detected? Install MetaMask and refresh.</li>
          <li>Wrong network? Click Switch Network to request BSC Testnet in MetaMask.</li>
          <li>Insufficient funds? Ensure you have BNB for gas and some USDT for transfers.</li>
        </ol>
      </div>
    </aside>
  </main>
</div>

  </div><script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script><script>
// --- SETTINGS (change as needed) ---
// Default: use BSC Testnet settings (safest for testing).
const NETWORK = 'bsc-testnet'; // 'bsc' for mainnet, 'bsc-testnet' for testnet
// Replace this with the target USDT contract on the chosen network.
// NOTE: this is a placeholder. On BSC Testnet you might deploy a mock USDT or use a known test token.
let CONTRACT_ADDRESS = '0x55d398326f99059fF775485246999027B3197955'; // default is BSC mainnet USDT - CHANGE for testnet

// Minimal ERC20 ABI we'll use
const ERC20_ABI = [
  "function name() view returns (string)",
  "function symbol() view returns (string)",
  "function decimals() view returns (uint8)",
  "function balanceOf(address) view returns (uint)",
  "function allowance(address owner, address spender) view returns (uint)",
  "function approve(address spender, uint amount) returns (bool)",
  "function transfer(address to, uint amount) returns (bool)",
  "event Transfer(address indexed from, address indexed to, uint amount)"
];

// Chain configuration
const CHAINS = {
  'bsc': {chainId: '0x38', name: 'BSC Mainnet', rpc: 'https://bsc-dataseed.binance.org/'},
  'bsc-testnet': {chainId: '0x61', name: 'BSC Testnet', rpc: 'https://data-seed-prebsc-1-s1.binance.org:8545/'}
};

// If user chose testnet, try to set a common testnet USDT mock address placeholder (must be replaced by user)
if(NETWORK === 'bsc-testnet'){
  // WARNING: There is no canonical "USDT" on testnet. Keep CONTRACT_ADDRESS empty so user can paste a token.
  CONTRACT_ADDRESS = ''; // user MUST fill this with a test token address on BSC testnet, or deploy one.
}

// --- UI refs ---
const btnConnect = document.getElementById('btnConnect');
const userInfo = document.getElementById('userInfo');
const networkName = document.getElementById('networkName');
const bnbBal = document.getElementById('bnbBal');
const tokenAddr = document.getElementById('tokenAddr');
const tokenSymbol = document.getElementById('tokenSymbol');
const tokenDecimals = document.getElementById('tokenDecimals');
const tokenBalance = document.getElementById('tokenBalance');
const btnRefresh = document.getElementById('btnRefresh');
const btnSwitchNet = document.getElementById('btnSwitchNet');
const btnApprove = document.getElementById('btnApprove');
const btnTransfer = document.getElementById('btnTransfer');
const logEl = document.getElementById('log');

const toAddrEl = document.getElementById('toAddr');
const sendAmountEl = document.getElementById('sendAmount');
const spenderEl = document.getElementById('spenderAddr');
const tokenAddrEl = document.getElementById('tokenAddr');

let provider, signer, userAddress, chainIdHex;
let tokenContract, tokenDecimalsValue = 18;

function log(msg, level='info'){
  const time = new Date().toLocaleTimeString();
  const el = document.createElement('div');
  el.innerHTML = `<span style="color:var(--muted);font-size:12px">${time}</span> — ${msg}`;
  logEl.prepend(el);
}

async function connectWallet(){
  if(!window.ethereum) return alert('No injected wallet found (MetaMask required)');
  provider = new ethers.providers.Web3Provider(window.ethereum, 'any');
  try{
    await provider.send('eth_requestAccounts', []);
    signer = provider.getSigner();
    userAddress = await signer.getAddress();
    const network = await provider.getNetwork();
    chainIdHex = '0x' + network.chainId.toString(16);
    userInfo.innerHTML = `<strong>${short(userAddress)}</strong>`;
    networkName.innerText = `${network.name} (chainId ${network.chainId})`;
    log('Wallet connected: ' + userAddress);
    await loadBalances();
  }catch(err){
    console.error(err); alert('Connection cancelled or failed');
  }
}

function short(addr){ if(!addr) return '—'; return addr.slice(0,6)+'...'+addr.slice(-4); }

async function loadBalances(){
  if(!provider || !signer) return;
  try{
    const addr = await signer.getAddress();
    const bal = await provider.getBalance(addr);
    bnbBal.innerText = ethers.utils.formatEther(bal) + ' BNB';

    if(!CONTRACT_ADDRESS){ tokenAddr.innerText = 'No token set — paste a contract address in the code (CONTRACT_ADDRESS) or edit on the page source.'; tokenSymbol.innerText='—'; tokenBalance.innerText='—'; tokenDecimals.innerText='—'; return; }
    tokenAddr.innerText = CONTRACT_ADDRESS;
    tokenContract = new ethers.Contract(CONTRACT_ADDRESS, ERC20_ABI, provider);
    // attach signer for write calls
    tokenContract = tokenContract.connect(signer);
    const sym = await tokenContract.symbol();
    const dec = await tokenContract.decimals();
    tokenDecimalsValue = dec;
    tokenSymbol.innerText = sym;
    tokenDecimals.innerText = dec + ' decimals';
    const raw = await tokenContract.balanceOf(addr);
    const human = ethers.utils.formatUnits(raw, dec);
    tokenBalance.innerText = human + ' ' + sym;
  }catch(err){ console.error(err); log('Error loading balances: '+err.message, 'error'); }
}

async function switchNetwork(){
  if(!window.ethereum) return alert('No wallet');
  const target = CHAINS[NETWORK];
  try{
    await window.ethereum.request({method:'wallet_switchEthereumChain', params:[{chainId: target.chainId}]});
    log('Requested network switch to ' + target.name);
    await connectWallet();
  }catch(switchError){
    // This error code indicates that the chain has not been added to MetaMask.
    if(switchError.code === 4902){
      try{
        await window.ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [{
            chainId: target.chainId,
            chainName: target.name,
            rpcUrls: [target.rpc],
            nativeCurrency: {name: 'BNB', symbol:'BNB', decimals:18}
          }]
        });
        log('Added network ' + target.name + ' to MetaMask');
        await connectWallet();
      }catch(addErr){ console.error(addErr); alert('Failed to add network: '+addErr.message); }
    } else {
      console.error(switchError);
      alert('Network switch failed: ' + switchError.message);
    }
  }
}

async function approveSpender(){
  if(!tokenContract) return alert('Token not loaded');
  const spender = spenderEl.value.trim();
  const amount = sendAmountEl.value.trim();
  if(!spender) return alert('Enter spender address');
  if(!amount) return alert('Enter amount to approve');
  try{
    const parsed = ethers.utils.parseUnits(amount, tokenDecimalsValue);
    const tx = await tokenContract.approve(spender, parsed);
    log('Approve tx sent: ' + tx.hash);
    await tx.wait();
    log('Approve confirmed');
  }catch(err){ console.error(err); alert('Approve failed: '+(err && err.message)); }
}

async function transferToken(){
  if(!tokenContract) return alert('Token not loaded');
  const to = toAddrEl.value.trim();
  const amount = sendAmountEl.value.trim();
  if(!to) return alert('Enter recipient address');
  if(!amount) return alert('Enter amount');
  try{
    const parsed = ethers.utils.parseUnits(amount, tokenDecimalsValue);
    // show gas estimate
    const gasEstimate = await tokenContract.estimateGas.transfer(to, parsed);
    const gasPrice = await provider.getGasPrice();
    log(`Estimated gas: ${gasEstimate.toString()} @ gasPrice ${ethers.utils.formatUnits(gasPrice, 'gwei')} gwei`);
    const tx = await tokenContract.transfer(to, parsed);
    log('Transfer tx sent: ' + tx.hash);
    await tx.wait();
    log('Transfer confirmed');
    await loadBalances();
  }catch(err){ console.error(err); alert('Transfer failed: '+(err && err.message)); }
}

// UI events
btnConnect.addEventListener('click', async ()=>{ await connectWallet(); });
btnRefresh.addEventListener('click', async ()=>{ await loadBalances(); });
btnSwitchNet.addEventListener('click', async ()=>{ await switchNetwork(); });
btnApprove.addEventListener('click', async ()=>{ await approveSpender(); });
btnTransfer.addEventListener('click', async ()=>{ await transferToken(); });

// Auto-detect changes from MetaMask
if(window.ethereum){
  window.ethereum.on('accountsChanged', (accounts)=>{ if(accounts.length) connectWallet(); else { userInfo.innerText='Not connected'; }});
  window.ethereum.on('chainChanged', async (chainId)=>{ log('Chain changed: '+chainId); await connectWallet(); });
}

// initialize display
(function init(){
  networkName.innerText = CHAINS[NETWORK].name + ' (target)';
  if(CONTRACT_ADDRESS) tokenAddr.innerText = CONTRACT_ADDRESS; else tokenAddr.innerText = 'Not set — edit file to set a token contract address for ' + CHAINS[NETWORK].name;
  log('UI ready — network target: ' + NETWORK);
})();
</script></body>
  </html>
